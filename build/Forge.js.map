{"version":3,"sources":["../src/Forge.js"],"names":["Forge","constructor","config","bindings","inspector","bind","name","binding","list","push","unbind","count","length","rebind","get","hint","args","resolve","getOne","context","getMatchingBindings","resolveBindings","getAll","undefined","create","type","filter","matches","all","results","map","inspect","lines","Object","keys","forEach","toString","join"],"mappings":"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","file":"Forge.js","sourcesContent":["import ensure from './util/ensure';\nimport Binding from './Binding';\nimport Context from './Context';\nimport Inspector from './Inspector';\nimport ResolutionError from './errors/ResolutionError';\n\nclass Forge {\n\n  constructor(config = {}) {\n    this.bindings = {};\n    this.inspector = config.inspector || new Inspector();\n  }\n\n  bind(name) {\n    ensure('name', name);\n    const binding = new Binding(this, name);\n    const list = this.bindings[name] ? this.bindings[name] : (this.bindings[name] = []);\n    list.push(binding);\n    return binding;\n  }\n\n  unbind(name) {\n    ensure('name', name);\n    const count = (this.bindings[name] != null) ? this.bindings[name].length : 0;\n    this.bindings[name] = [];\n    return count;\n  }\n\n  rebind(name) {\n    ensure('name', name);\n    this.unbind(name);\n    return this.bind(name);\n  }\n\n  get(name, hint, args) {\n    ensure('name', name);\n    return this.resolve(name, new Context(), hint, false, args);\n  }\n\n  getOne(name, hint, args) {\n    ensure('name', name);\n    const context = new Context();\n    const bindings = this.getMatchingBindings(name, hint);\n    if (bindings.length === 0) {\n      throw new ResolutionError(name, hint, context, 'No matching bindings were available');\n    }\n    if (bindings.length !== 1) {\n      throw new ResolutionError(name, hint, context, 'Multiple matching bindings were available');\n    }\n    return this.resolveBindings(context, bindings, hint, args, false);\n  }\n\n  getAll(name, args) {\n    ensure('name', name);\n    const context = new Context();\n    const bindings = this.bindings[name];\n    if (!bindings || bindings.length === 0) {\n      throw new ResolutionError(name, undefined, context, 'No matching bindings were available');\n    }\n    return this.resolveBindings(context, bindings, undefined, args, true);\n  }\n\n  create(type, args) {\n    ensure('type', type);\n    const context = new Context();\n    const binding = new Binding(this, type.constructor.name).type(type);\n    return this.resolveBindings(context, [binding], undefined, args, false);\n  }\n\n  getMatchingBindings(name, hint) {\n    ensure('name', name);\n    if (!this.bindings[name]) {\n      return [];\n    } else {\n      return this.bindings[name].filter(binding => binding.matches(hint));\n    }\n  }\n\n  resolve(name, context, hint, all, args) {\n    ensure('name', name);\n\n    if (context == null) context = new Context();\n    const bindings = all ? this.bindings[name] : this.getMatchingBindings(name, hint);\n\n    if (!bindings || bindings.length === 0) {\n      throw new ResolutionError(name, hint, context, 'No matching bindings were available');\n    }\n\n    return this.resolveBindings(context, bindings, hint, args, all);\n  }\n\n  resolveBindings(context, bindings, hint, args, all) {\n    const results = bindings.map(binding => binding.resolve(context, hint, args));\n    if (!all && results.length === 1) {\n      return results[0];\n    } else {\n      return results;\n    }\n  }\n\n  inspect() {\n    const lines = [];\n    Object.keys(this.bindings).forEach(name => {\n      this.bindings[name].forEach(binding => {\n        lines.push(binding.toString());\n      });\n    });\n    return lines.join('\\n');\n  }\n\n}\n\nexport default Forge;\n"]}