// Generated by CoffeeScript 1.10.0
(function() {
  var Inspector, _, assert;

  assert = require('assert');

  _ = require('underscore');

  Inspector = (function() {
    function Inspector(unmangleNames) {
      this.unmangleNames = unmangleNames != null ? unmangleNames : false;
    }

    Inspector.prototype.getDependencies = function(func) {
      var hints, params;
      assert(func != null, 'The argument "func" must have a value');
      params = this.getParameterNames(func);
      hints = this.getDependencyHints(func);
      return _.map(params, function(param) {
        var ref;
        return (ref = hints[param]) != null ? ref : {
          name: param,
          all: false,
          hint: void 0
        };
      });
    };

    Inspector.prototype.getParameterNames = function(func) {
      var args, matches, regex;
      assert(func != null, 'The argument "func" must have a value');
      regex = /(?:function|constructor)[ A-Za-z0-9]*\(([^)]+)/g;
      matches = regex.exec(func.toString());
      if ((matches == null) || matches[1].length === 0) {
        return [];
      }
      args = matches[1].split(/[,\s]+/);
      if (this.unmangleNames) {
        return _.map(args, function(arg) {
          return arg.replace(/\d+$/, '');
        });
      } else {
        return args;
      }
    };

    Inspector.prototype.getDependencyHints = function(func) {
      var all, argument, dependency, hint, hints, match, name, pattern, ref, regex;
      assert(func != null, 'The argument "func" must have a value');
      regex = /"(.*?)\s*->\s*(all)?\s*(.*?)";/gi;
      hints = {};
      while (match = regex.exec(func.toString())) {
        pattern = match[0], argument = match[1], all = match[2], dependency = match[3];
        if (all != null) {
          all = true;
        }
        if (dependency.indexOf(':')) {
          ref = dependency.split(/\s*:\s*/, 2), name = ref[0], hint = ref[1];
        } else {
          name = dependency;
          hint = void 0;
        }
        hints[argument] = {
          name: name,
          all: all,
          hint: hint
        };
      }
      return hints;
    };

    Inspector.prototype.isAutoConstructor = function(constructor) {
      var body, name;
      assert(constructor != null, 'The argument "constructor" must have a value');
      name = constructor.name;
      body = constructor.toString();
      return body.indexOf(name + ".__super__.constructor.apply(this, arguments);") > 0;
    };

    return Inspector;

  })();

  module.exports = Inspector;

}).call(this);
